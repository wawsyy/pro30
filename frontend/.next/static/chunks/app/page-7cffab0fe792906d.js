(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{20597:function(e,t,n){Promise.resolve().then(n.bind(n,19448))},19448:function(e,t,n){"use strict";let r;n.d(t,{ReflectionApp:function(){return q}});var i=n(57437),a=n(2265),l=n(67872),s=n(64707),o=n(58957),c=n(38217),d=n(16693),u=n(59222),y=n(69146),m=n(59868),p=n(94552),f=n(3876);let h="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class v{isLoaded(){return b(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!w(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(h,'"]'))){b(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let n=document.createElement("script");n.src=h,n.type="text/javascript",n.async=!0,n.onload=()=>{b(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(h,", however, the window.relayerSDK object is invalid.")))),e()},n.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(h)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(n),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function w(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):g(e,"initSDK","function",t)?g(e,"createInstance","function",t)?g(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function b(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?w(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function g(e,t,n,r){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==r||r("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let i=e[t];return null==i?(null==r||r("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof i===n||(null==r||r("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(n,".")),!1)}var x=n(90960);async function S(){return r||(r=(0,x.X3)("fhevm",1,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function j(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function E(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function N(e){let t;let n=await S();if(!n)return{publicParams:null};let r=null;try{let t=await n.get("publicKeyStore",e);(null==t?void 0:t.value)&&(j(t.value),r=t.value)}catch(e){}let i=null;try{let t=await n.get("paramsStore",e);(null==t?void 0:t.value)&&(E(t.value),i=t.value)}catch(e){}let a=null==r?void 0:r.publicKey,l=null==r?void 0:r.publicKeyId,s=i?{2048:i}:null;return l&&a&&(t={id:l,data:a}),{...void 0!==t&&{publicKey:t},publicParams:s}}async function R(e,t,n){j(t),E(n);let r=await S();r&&(t&&await r.put("publicKeyStore",{acl:e,value:t}),n&&await r.put("paramsStore",{acl:e,value:n}))}class L extends Error{constructor(e,t,n){super(t,n),this.code=e,this.name="FhevmReactError"}}function K(e,t,n){throw new L(e,t,n?{cause:n}:void 0)}let D=()=>!!b(window,console.log)&&!0===window.relayerSDK.__initialized__,P=()=>new v({trace:console.log}).load(),T=async e=>{if(!b(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class C extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function I(e){if("string"==typeof e){let t=new u.r6(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function M(e){let t=new u.r6(e);try{return await t.send("web3_clientVersion",[])}catch(t){K("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function _(e){let t=await M(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await A(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function A(e){let t=new u.r6(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){K("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function F(e,t){let n=await I(e),r="string"==typeof e?e:void 0,i={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(i,n)?(r||(r=i[n]),{isMock:!0,chainId:n,rpcUrl:r}):{isMock:!1,chainId:n,rpcUrl:r}}let k=async e=>{let t=()=>{if(i.aborted)throw new C},r=e=>{a&&a(e)},{signal:i,onStatusChange:a,provider:l,mockChains:s}=e,{isMock:o,rpcUrl:c,chainId:d}=await F(l,s);if(o){let e=await _(c);if(e){r("creating");let i=await Promise.all([n.e(4057),n.e(9678)]).then(n.bind(n,39678)),a=await i.fhevmMockCreateInstance({rpcUrl:c,chainId:d,metadata:e});return t(),a}}t(),b(window,console.log)||(r("sdk-loading"),await P(),t(),r("sdk-loaded")),D()||(r("sdk-initializing"),await T(),t(),r("sdk-initialized"));let u=window.relayerSDK,y=u.SepoliaConfig.aclContractAddress;if(!("string"==typeof y&&(0,f.UJ)(y)))throw Error("Invalid address: ".concat(y));let m=await N(y);t();let p={...u.SepoliaConfig,network:l,publicKey:m.publicKey,publicParams:m.publicParams};r("creating");let h=await u.createInstance(p);return await R(y,h.getPublicKey(),h.getPublicParams(2048)),t(),h};function V(e,t){if(!e){let e=t?"Assertion failed: ".concat(t):"Assertion failed.";throw console.error(e),Error(e)}}var U=n(45721);let H={11155111:{address:"0x34B61B8816BC506B1965d887b4A6Bb02eBDAe35d",chainId:11155111,chainName:"sepolia"},31337:{address:"0x5FbDB2315678afecb367f032d93F642f64180aa3",chainId:31337,chainName:"hardhat"}},W={abi:[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"entryId",type:"uint256"},{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"AccessGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"entryId",type:"uint256"},{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"ReflectionEntryAdded",type:"event"},{inputs:[{internalType:"string",name:"content",type:"string"},{internalType:"externalEuint32",name:"encryptedStressLevelInput",type:"bytes32"},{internalType:"bytes",name:"encryptedStressLevelProof",type:"bytes"},{internalType:"externalEuint32",name:"encryptedAchievementLevelInput",type:"bytes32"},{internalType:"bytes",name:"encryptedAchievementLevelProof",type:"bytes"},{internalType:"externalEuint32",name:"encryptedMindsetPositiveInput",type:"bytes32"},{internalType:"bytes",name:"encryptedMindsetPositiveProof",type:"bytes"}],name:"addReflection",outputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"entryExists",outputs:[{internalType:"bool",name:"exists",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"getEntry",outputs:[{components:[{internalType:"address",name:"owner",type:"address"},{internalType:"string",name:"content",type:"string"},{internalType:"euint32",name:"encryptedStressLevel",type:"bytes32"},{internalType:"euint32",name:"encryptedAchievementLevel",type:"bytes32"},{internalType:"euint32",name:"encryptedMindsetPositive",type:"bytes32"},{internalType:"uint256",name:"timestamp",type:"uint256"},{internalType:"bool",name:"exists",type:"bool"}],internalType:"struct EncryptedNightlyReflection.ReflectionEntry",name:"entry",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"getEntryAchievementLevel",outputs:[{internalType:"euint32",name:"encryptedAchievementLevel",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"getEntryContent",outputs:[{internalType:"string",name:"content",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"getEntryMindset",outputs:[{internalType:"euint32",name:"encryptedMindsetPositive",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],name:"getEntryStressLevel",outputs:[{internalType:"euint32",name:"encryptedStressLevel",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getTotalEntries",outputs:[{internalType:"uint256",name:"count",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getUserEntries",outputs:[{internalType:"uint256[]",name:"entryIds",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"getUserEntryByIndex",outputs:[{internalType:"uint256",name:"entryId",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getUserEntryCount",outputs:[{internalType:"uint256",name:"count",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"}]},z=()=>{let{address:e,isConnected:t}=(0,s.m)(),r=(0,o.x)(),{data:i}=(0,c.p)(),l=(0,d.t)(),{storage:f}=(0,U.F)(),[h,v]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),[g,x]=(0,a.useState)(null),S=(0,a.useMemo)(()=>{var e;if(r)return null===(e=H[r.toString()])||void 0===e?void 0:e.address},[r]),j=(0,a.useMemo)(()=>window.ethereum?window.ethereum:31337===r?"http://localhost:8545":void 0,[r]),E=(0,a.useMemo)(()=>{if(!l)return;let e=l.transport;return e&&e.url?new u.r6(e.url):window.ethereum?new y.Q(window.ethereum):void 0},[l]),N=t&&!!j&&!!r,{instance:R,status:L,error:K}=function(e){let{provider:t,chainId:n,initialMockChains:r,enabled:i=!0}=e,[l,s]=(0,a.useState)(void 0),[o,c]=(0,a.useState)("idle"),[d,u]=(0,a.useState)(void 0),[y,m]=(0,a.useState)(i),[p,f]=(0,a.useState)(0),h=(0,a.useRef)(null),v=(0,a.useRef)(t),w=(0,a.useRef)(n),b=(0,a.useRef)(r),g=(0,a.useCallback)(()=>{h.current&&(v.current=void 0,w.current=void 0,h.current.abort(),h.current=null),v.current=t,w.current=n,s(void 0),u(void 0),c("idle"),void 0!==t&&f(e=>e+1)},[t,n]);return(0,a.useEffect)(()=>{g()},[g]),(0,a.useEffect)(()=>{m(i)},[i]),(0,a.useEffect)(()=>{if(!1===y){console.log("cancelled"),h.current&&(h.current.abort(),h.current=null),s(void 0),u(void 0),c("idle");return}if(!0===y){if(void 0===v.current){s(void 0),u(void 0),c("idle");return}h.current||(h.current=new AbortController),V(!h.current.signal.aborted,"!controllerRef.current.signal.aborted"),c("loading"),u(void 0);let e=h.current.signal,t=v.current;k({signal:e,provider:t,mockChains:b.current,onStatusChange:e=>console.log("[useFhevm] createFhevmInstance status changed: ".concat(e))}).then(n=>{console.log("[useFhevm] createFhevmInstance created!"),e.aborted||(V(t===v.current,"thisProvider === _providerRef.current"),s(n),u(void 0),c("ready"))}).catch(n=>{"FhevmAbortError"!==n.name&&console.log("Error Was thrown !!! error... "+n.name),e.aborted||(V(t===v.current,"thisProvider === _providerRef.current"),s(void 0),u(n),c("error"))})}},[y,p]),{instance:l,refresh:g,error:d,status:o}}({provider:j,chainId:r,enabled:N,initialMockChains:{31337:"http://localhost:8545"}}),D=(0,a.useCallback)(async(t,r,a,l)=>{if(!R||"ready"!==L)throw Error("FHEVM instance not ready. Status: "+L);if(!i||!S||!e)throw Error("Wallet, contract, or address not available");v(!0),b(!0);try{let s=async function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0,a=null;for(;i<r;)try{console.log("[useReflectionContract] Encrypting ".concat(n," (attempt ").concat(i+1,"/").concat(r,")..."));let a=R.createEncryptedInput(S,e);a.add32(t);let l=await a.encrypt();return console.log("[useReflectionContract] ".concat(n," encryption successful")),l}catch(l){i++,a=l;let e=(null==l?void 0:l.message)||String(l);if(console.warn("[useReflectionContract] ".concat(n," encryption attempt ").concat(i," failed:"),e),i>=r)throw Error("Failed to encrypt ".concat(n," after ").concat(r," attempts. ")+"Last error: ".concat(e,". ")+"This may be due to FHEVM Relayer service issues. Please try again later.");let t=1e3*Math.pow(2,i);console.log("[useReflectionContract] Waiting ".concat(t/1e3,"s before retry...")),await new Promise(e=>setTimeout(e,t))}throw a||Error("Failed to encrypt ".concat(n))},o=await s(Math.max(0,Math.min(100,Math.floor(r))),"stress level"),c=await s(Math.max(0,Math.min(100,Math.floor(a))),"achievement level"),d=await s(l?1:0,"mindset");if(v(!1),!i)throw Error("Wallet client not available");let{createWalletClient:u,http:p}=await n.e(9225).then(n.bind(n,9225)),{privateKeyToAccount:f}=await n.e(8146).then(n.bind(n,18146));if(!window.ethereum)throw Error("Ethereum provider not available");let h=new y.Q(window.ethereum),w=await h.getSigner(),b=new m.CH(S,W.abi,w),g=await b.addReflection(t,o.handles[0],o.inputProof,c.handles[0],c.inputProof,d.handles[0],d.inputProof),x=await g.wait();console.log("[useReflectionContract] Transaction confirmed:",null==x?void 0:x.hash),await new Promise(e=>setTimeout(e,1e3))}finally{v(!1),b(!1)}},[R,i,S,e,E]),P=(0,a.useCallback)(async()=>{if(!E||!S||!e)return[];try{let t=new m.CH(S,W.abi,E);return await t.getUserEntries(e)}catch(n){var t;let e=(null==n?void 0:null===(t=n.message)||void 0===t?void 0:t.toLowerCase())||String(n).toLowerCase();return e.includes("failed to fetch")||e.includes("network")||console.error("Error getting user entries:",n),[]}},[E,S,e]),T=(0,a.useCallback)(async e=>{if(!E||!S)throw Error("Provider or contract not available");let t=new m.CH(S,W.abi,E);return await t.getEntry(e)},[E,S]),C=(0,a.useCallback)(async t=>{if(!R||!i||!S||!e)throw Error("FHEVM instance, wallet, or contract not available");b(!0);try{let n;let r=await T(t),a=r.content,l=r.encryptedStressLevel,s=r.encryptedAchievementLevel,o=r.encryptedMindsetPositive,{publicKey:c,privateKey:d}=R.generateKeypair(),u=Math.floor(Date.now()/1e3),m=R.createEIP712(c,[S],u,365);if(console.log("[useReflectionContract] Requesting wallet signature for decryption..."),!i)throw Error("Wallet client not available for signing");try{n=await i.signTypedData({account:e,domain:m.domain,types:{UserDecryptRequestVerification:m.types.UserDecryptRequestVerification},primaryType:"UserDecryptRequestVerification",message:m.message}),console.log("[useReflectionContract] Signature received from walletClient")}catch(r){console.error("[useReflectionContract] walletClient.signTypedData failed:",r);let e=new y.Q(window.ethereum),t=await e.getSigner();n=await t.signTypedData(m.domain,{UserDecryptRequestVerification:m.types.UserDecryptRequestVerification},m.message)}console.log("[useReflectionContract] Signature obtained, proceeding with decryption...");let p=await R.userDecrypt([{handle:l,contractAddress:S}],d,c,n,[S],e,u,365),f=await R.userDecrypt([{handle:s,contractAddress:S}],d,c,n,[S],e,u,365),h=await R.userDecrypt([{handle:o,contractAddress:S}],d,c,n,[S],e,u,365);return{content:a,stressLevel:Number(p[l]),achievementLevel:Number(f[s]),mindsetPositive:!!h[o],timestamp:Number(r.timestamp)}}finally{b(!1)}},[R,i,S,e,T]),I=(0,a.useCallback)(()=>{x(null)},[]);return{addReflection:D,getUserEntries:P,getEntry:T,decryptEntry:C,fheLoading:h,isLoading:w,contractAddress:S,isDeployed:!!S&&S!==p.N,fhevmStatus:L,fhevmError:K,fhevmReady:"ready"===L&&!!R,lastError:g,clearError:I}};n(89279);let O=e=>{let{onEntryAdded:t}=e,[n,r]=(0,a.useState)(""),[l,o]=(0,a.useState)(50),[c,d]=(0,a.useState)(50),[u,y]=(0,a.useState)(!0),[m,p]=(0,a.useState)(!1),[f,h]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),[b,g]=(0,a.useState)(0),{address:x}=(0,s.m)(),{addReflection:S,fheLoading:j,fhevmReady:E,fhevmStatus:N,fhevmError:R}=z(),L=e=>{r(e),g(e.length)},K=async e=>{if(e.preventDefault(),h(null),w(null),!n.trim()){w("Please enter your reflection content");return}if(n.length>1e3){w("Reflection content must be less than 1000 characters");return}if(!x){w("Please connect your wallet");return}p(!0);try{await S(n.trim(),l,c,u),r(""),o(50),d(50),y(!0),h("Reflection entry added successfully!"),setTimeout(()=>h(null),3e3),t&&setTimeout(()=>{console.log("[ReflectionForm] Triggering list refresh after entry added"),t()},3e3)}catch(n){console.error("Error adding reflection entry:",n);let e=(null==n?void 0:n.message)||String(n),t=e.toLowerCase();if(["failed to fetch","analytics","walletconnect","web3modal","coinbase","cca-lite","pulse.walletconnect","api.web3modal","network error","cors","blocked by response"].some(e=>t.includes(e))){console.log("Ignored non-critical error:",e);return}t.includes("relayer")||t.includes("bad json")||t.includes("connection closed")||t.includes("encrypt")||t.includes("failed to encrypt")?w("FHEVM Relayer service is temporarily unavailable. This is a network issue with the encryption service. Please try again in a few moments."):w("Failed to add reflection entry. Please try again."),setTimeout(()=>w(null),5e3)}finally{p(!1)}},D=m||!n.trim()||j||!E;return(0,i.jsxs)("div",{className:"reflection-form",children:[(0,i.jsx)("h2",{className:"reflection-form-title",children:"Add New Reflection Entry"}),(0,i.jsxs)("form",{onSubmit:K,className:"reflection-form-form",children:[f&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded text-green-200 text-sm",children:["✓ ",f]}),v&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded text-red-200 text-sm",children:["✗ ",v]}),(0,i.jsxs)("div",{className:"reflection-form-group",children:[(0,i.jsx)("label",{htmlFor:"content",className:"reflection-form-label",children:"Reflection Content"}),(0,i.jsx)("textarea",{id:"content",rows:6,className:"reflection-form-textarea",placeholder:"Write your nightly reflection here... What were your thoughts today?",value:n,onChange:e=>L(e.target.value),disabled:m,maxLength:1e3}),(0,i.jsxs)("div",{className:"text-xs text-gray-400 mt-1 text-right",children:[b,"/1000 characters"]})]}),(0,i.jsxs)("div",{className:"reflection-form-group",children:[(0,i.jsxs)("label",{htmlFor:"stressLevel",className:"reflection-form-label",children:["Stress Level: ",l,"%"]}),(0,i.jsx)("input",{type:"range",id:"stressLevel",min:"0",max:"100",value:l,onChange:e=>o(Number(e.target.value)),className:"reflection-form-range",disabled:m})]}),(0,i.jsxs)("div",{className:"reflection-form-group",children:[(0,i.jsxs)("label",{htmlFor:"achievementLevel",className:"reflection-form-label",children:["Achievement Level: ",c,"%"]}),(0,i.jsx)("input",{type:"range",id:"achievementLevel",min:"0",max:"100",value:c,onChange:e=>d(Number(e.target.value)),className:"reflection-form-range",disabled:m})]}),(0,i.jsx)("div",{className:"reflection-form-group",children:(0,i.jsxs)("label",{className:"reflection-form-label",children:[(0,i.jsx)("input",{type:"checkbox",checked:u,onChange:e=>y(e.target.checked),className:"reflection-form-checkbox",disabled:m}),(0,i.jsx)("span",{className:"ml-2",children:"Positive mindset adjustment for tomorrow"})]})}),(0,i.jsxs)("div",{className:"reflection-form-submit",children:[!E&&"ready"!==N&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-yellow-500/20 border border-yellow-500/50 rounded text-yellow-200 text-sm",children:["loading"===N&&"Initializing FHE encryption...","error"===N&&(()=>{var e;let t=(null==R?void 0:null===(e=R.message)||void 0===e?void 0:e.toLowerCase())||"";return t.includes("failed to fetch")||t.includes("network")||t.includes("analytics")||t.includes("walletconnect")?"Initializing FHE encryption...":"FHE initialization failed: ".concat((null==R?void 0:R.message)||"Unknown error")})(),"idle"===N&&"Waiting for wallet connection..."]}),(0,i.jsx)("button",{type:"submit",disabled:D,className:"reflection-form-button ".concat(D?"reflection-form-button-disabled":"reflection-form-button-active"),children:E?j?"Encrypting...":m?"Adding Entry...":"Add Reflection Entry":"Initializing FHE..."})]})]})]})};n(97770);let B=e=>{let{refreshTrigger:t=0}=e,{address:n}=(0,s.m)(),{getUserEntries:r,decryptEntry:l,isLoading:o}=z(),[c,d]=(0,a.useState)([]),[u,y]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[f,h]=(0,a.useState)("newest"),v=a.useCallback(async()=>{if(!n){d([]);return}y(!0);try{console.log("[ReflectionList] Loading entries for address:",n);let e=await r();if(console.log("[ReflectionList] Loaded entry IDs:",e,"Type:",typeof e,"Length:",null==e?void 0:e.length),!e||0===e.length){console.log("[ReflectionList] No entries found"),d([]);return}let t=[];for(let n of e){let e=Number(n);t.push({id:e,content:"",stressLevel:0,achievementLevel:0,mindsetPositive:!1,timestamp:0,encrypted:!0})}console.log("[ReflectionList] Setting entries:",t);let i=[...t].sort((e,t)=>"newest"===f?t.timestamp-e.timestamp:e.timestamp-t.timestamp);d(i)}catch(n){var e;let t=(null==n?void 0:null===(e=n.message)||void 0===e?void 0:e.toLowerCase())||String(n).toLowerCase();t.includes("failed to fetch")||t.includes("network")||console.error("[ReflectionList] Error loading entries:",n)}finally{y(!1)}},[n,r]),w=async e=>{p(e);try{let t=await l(e);d(n=>n.map(n=>n.id===e?{...n,...t,encrypted:!1}:n))}catch(n){var t;let e=(null==n?void 0:null===(t=n.message)||void 0===t?void 0:t.toLowerCase())||String(n).toLowerCase();e.includes("failed to fetch")||e.includes("network")||console.error("Error decrypting entry:",n)}finally{p(null)}};return((0,a.useEffect)(()=>{console.log("[ReflectionList] useEffect triggered, address:",n,"refreshTrigger:",t),v()},[n,t,v]),u)?(0,i.jsxs)("div",{className:"reflection-list",children:[(0,i.jsx)("h2",{className:"reflection-list-title",children:"My Reflections"}),(0,i.jsx)("p",{className:"text-center py-8",children:"Loading entries..."})]}):0===c.length?(0,i.jsxs)("div",{className:"reflection-list",children:[(0,i.jsx)("h2",{className:"reflection-list-title",children:"My Reflections"}),(0,i.jsx)("p",{className:"text-center py-8 text-gray-600",children:"No reflection entries yet. Create your first entry above!"})]}):(0,i.jsxs)("div",{className:"reflection-list",children:[(0,i.jsxs)("div",{className:"reflection-list-header",children:[(0,i.jsx)("h2",{className:"reflection-list-title",children:"My Reflections"}),(0,i.jsxs)("div",{className:"reflection-sort-controls",children:[(0,i.jsx)("label",{className:"text-sm text-gray-600 mr-2",children:"Sort by:"}),(0,i.jsxs)("select",{value:f,onChange:e=>h(e.target.value),className:"text-sm bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white",children:[(0,i.jsx)("option",{value:"newest",children:"Newest First"}),(0,i.jsx)("option",{value:"oldest",children:"Oldest First"})]})]})]}),(0,i.jsx)("div",{className:"reflection-entries",children:c.map(e=>(0,i.jsxs)("div",{className:"reflection-entry",children:[(0,i.jsxs)("div",{className:"reflection-entry-header",children:[(0,i.jsxs)("span",{className:"reflection-entry-id",children:["Entry #",e.id]}),e.timestamp>0&&(0,i.jsx)("span",{className:"reflection-entry-date",children:new Date(1e3*e.timestamp).toLocaleDateString()})]}),e.encrypted?(0,i.jsxs)("div",{className:"reflection-entry-encrypted",children:[(0,i.jsx)("p",{className:"text-gray-500 mb-4",children:"This entry is encrypted. Click decrypt to view your reflection."}),(0,i.jsx)("button",{onClick:()=>w(e.id),disabled:m===e.id||o,className:"reflection-decrypt-button",children:m===e.id?"Decrypting...":"Decrypt Entry"})]}):(0,i.jsxs)("div",{className:"reflection-entry-content",children:[(0,i.jsxs)("div",{className:"reflection-entry-text",children:[(0,i.jsx)("strong",{children:"Reflection:"}),(0,i.jsx)("p",{children:e.content})]}),(0,i.jsxs)("div",{className:"reflection-entry-metrics",children:[(0,i.jsxs)("div",{className:"reflection-metric",children:[(0,i.jsx)("span",{className:"reflection-metric-label",children:"Stress Level:"}),(0,i.jsxs)("span",{className:"reflection-metric-value",children:[e.stressLevel,"%"]})]}),(0,i.jsxs)("div",{className:"reflection-metric",children:[(0,i.jsx)("span",{className:"reflection-metric-label",children:"Achievement Level:"}),(0,i.jsxs)("span",{className:"reflection-metric-value",children:[e.achievementLevel,"%"]})]}),(0,i.jsxs)("div",{className:"reflection-metric",children:[(0,i.jsx)("span",{className:"reflection-metric-label",children:"Mindset:"}),(0,i.jsx)("span",{className:"reflection-metric-value ".concat(e.mindsetPositive?"text-green-600":"text-red-600"),children:e.mindsetPositive?"Positive":"Needs Adjustment"})]})]})]})]},e.id))})]})};n(8787);let q=()=>{let[e,t]=(0,a.useState)(!1),[n,r]=(0,a.useState)(0),[o,c]=(0,a.useState)(!0),{isConnected:d}=(0,s.m)(),{isLoading:u}=z();(0,a.useEffect)(()=>{t(!0);let e=setTimeout(()=>c(!1),1e3);return()=>clearTimeout(e)},[]);let y=(0,a.useCallback)(()=>{r(e=>e+1)},[]);return!e||o?(0,i.jsx)("div",{className:"app-container",children:(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,i.jsx)("div",{className:"text-white",children:"Loading..."})})}):(0,i.jsx)("div",{className:"app-container",children:(0,i.jsx)("div",{className:"main-content",children:(0,i.jsxs)("div",{className:"content-wrapper",children:[(0,i.jsxs)("div",{className:"title-section",children:[(0,i.jsx)("h1",{className:"main-title text-white",children:"Encrypted Nightly Reflection"}),(0,i.jsx)("p",{className:"main-subtitle text-gray-200",children:"Record your daily reflections with complete privacy. Your thoughts about stress, achievements, and mindset adjustments are encrypted using Zama FHE technology."})]}),(0,i.jsx)("div",{className:"flex justify-end mb-4",children:(0,i.jsx)(l.NL,{})}),d?(0,i.jsxs)("div",{className:"content-sections",children:[(0,i.jsx)(O,{onEntryAdded:y}),(0,i.jsx)(B,{refreshTrigger:n})]}):(0,i.jsxs)("div",{className:"connect-card",children:[(0,i.jsx)("h2",{className:"connect-title",children:"Connect Your Wallet"}),(0,i.jsx)("p",{className:"connect-subtitle",children:"Connect your Rainbow wallet to start creating your encrypted reflection entries"})]})]})})})}},45721:function(e,t,n){"use strict";n.d(t,{p:function(){return y},F:function(){return u}});var r=n(57437),i=n(2265),a=n(53359),l=n(31378),s=n(70262),o=new WeakMap;class c{getItem(e){return(0,a._)(this,o).has(e)?(0,a._)(this,o).get(e):null}setItem(e,t){(0,a._)(this,o).set(e,t)}removeItem(e){(0,a._)(this,o).delete(e)}constructor(){(0,l._)(this,o,{writable:!0,value:void 0}),(0,s._)(this,o,new Map)}}let d=(0,i.createContext)(void 0),u=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("useInMemoryStorage must be used within a InMemoryStorageProvider");return e},y=e=>{let{children:t}=e,[n]=(0,i.useState)(new c);return(0,r.jsx)(d.Provider,{value:{storage:n},children:t})}},8787:function(){},89279:function(){},97770:function(){}},function(e){e.O(0,[1553,9472,1026,1765,8034,2971,2117,1744],function(){return e(e.s=20597)}),_N_E=e.O()}]);