{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    // Ensure this only runs in the browser\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string // \"string\", \"number\", etc.\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA;;IAGA,cAAc,IAAA,8JAAM,EAAiB,SAAS,GAAG;QAC/C,SAAQ,EAAE;YACR,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,gBAAgB;gBAChD,GAAG,iBAAiB,CAAC,eAAe;oBAAE,SAAS;gBAAM;YACvD;YACA,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,mBAAmB;gBACnD,GAAG,iBAAiB,CAAC,kBAAkB;oBAAE,SAAS;gBAAM;YAC1D;QACF;IACF;IACA,OAAO;AACT;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAO;IACnB;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAO;IACnB;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACP;IAEL;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,eAAA,yBAAA,GAAI,KAAK,EAAE;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,UAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,eAAA,yBAAA,GAAI,KAAK,EAAE;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,UAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,4BAAA,sCAAA,gBAAiB,SAAS;IAChD,MAAM,cAAc,4BAAA,sCAAA,gBAAiB,WAAW;IAChD,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  if (typeof providerOrUrl === \"string\") {\r\n    const provider = new JsonRpcProvider(providerOrUrl);\r\n    return Number((await provider.getNetwork()).chainId);\r\n  }\r\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\r\n  return Number.parseInt(chainId as string, 16);\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"web3_clientVersion\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"WEB3_CLIENTVERSION_ERROR\",\r\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  const version = await getWeb3Client(rpcUrl);\r\n  if (\r\n    typeof version !== \"string\" ||\r\n    !version.toLowerCase().includes(\"hardhat\")\r\n  ) {\r\n    return undefined;\r\n  }\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl);\r\n  try {\r\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\r\n    return version;\r\n  } catch (e) {\r\n    throwFhevmError(\r\n      \"FHEVM_RELAYER_METADATA_ERROR\",\r\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\r\n      e\r\n    );\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  const chainId = await getChainId(providerOrUrl);\r\n\r\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n  const _mockChains: Record<number, string> = {\r\n    31337: \"http://localhost:8545\",\r\n    ...(mockChains ?? {}),\r\n  };\r\n\r\n  if (Object.hasOwn(_mockChains, chainId)) {\r\n    if (!rpcUrl) {\r\n      rpcUrl = _mockChains[chainId];\r\n    }\r\n\r\n    return { isMock: true, chainId, rpcUrl };\r\n  }\r\n\r\n  return { isMock: false, chainId, rpcUrl };\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\r\n\r\n  if (isMock) {\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      notify(\"creating\");\r\n\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 508, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    // Provider or chainId has changed. Abort immediately\r\n    if (_abortControllerRef.current) {\r\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n\r\n    // Nullify instance immediately\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      // Force call main useEffect\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n\r\n    // Do not modify the running flag.\r\n  }, [provider, chainId]);\r\n\r\n  // Merge in main useEffect!!!\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  // Main useEffect\r\n  useEffect(() => {\r\n    // is _providerRef.current valid here ?\r\n    // even if the first useEffect is rendered in the same render-cycle ?\r\n    if (_isRunning === false) {\r\n      // cancelled\r\n      console.log(\"cancelled\");\r\n      if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      // May already be null if provider was changed in the previous render-cycle\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        // instance should be undefined\r\n        // this code below should be unecessary\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      // Keep old instance\r\n      // Was set to undefined if provider changed\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      // Can be undefined, if so, call eth_chainId\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          //console.log(`completed (runId=${thisRunId})...`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          // is there a edge case where the assert below would fail ?\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          // Only log non-abort errors\r\n          if (e.name !== 'FhevmAbortError') {\r\n            console.log(`Error Was thrown !!! error... ` + e.name);\r\n          }\r\n          if (thisSignal.aborted) return;\r\n\r\n          // it's not possible to have a _providerRef modified without a prior abort\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(undefined);\r\n          _setError(e);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/abi/EncryptedNightlyReflectionAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedNightlyReflectionAddresses = { \n  \"11155111\": { address: \"0x34B61B8816BC506B1965d887b4A6Bb02eBDAe35d\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,sCAAsC;IACjD,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 698, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/abi/EncryptedNightlyReflectionABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedNightlyReflectionABI = {\n  \"abi\": [\n    {\n      \"inputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"constructor\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"AccessGranted\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"owner\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"uint256\",\n          \"name\": \"timestamp\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"ReflectionEntryAdded\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"content\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedStressLevelInput\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"encryptedStressLevelProof\",\n          \"type\": \"bytes\"\n        },\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedAchievementLevelInput\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"encryptedAchievementLevelProof\",\n          \"type\": \"bytes\"\n        },\n        {\n          \"internalType\": \"externalEuint32\",\n          \"name\": \"encryptedMindsetPositiveInput\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"encryptedMindsetPositiveProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"addReflection\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"entryExists\",\n      \"outputs\": [\n        {\n          \"internalType\": \"bool\",\n          \"name\": \"exists\",\n          \"type\": \"bool\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEntry\",\n      \"outputs\": [\n        {\n          \"components\": [\n            {\n              \"internalType\": \"address\",\n              \"name\": \"owner\",\n              \"type\": \"address\"\n            },\n            {\n              \"internalType\": \"string\",\n              \"name\": \"content\",\n              \"type\": \"string\"\n            },\n            {\n              \"internalType\": \"euint32\",\n              \"name\": \"encryptedStressLevel\",\n              \"type\": \"bytes32\"\n            },\n            {\n              \"internalType\": \"euint32\",\n              \"name\": \"encryptedAchievementLevel\",\n              \"type\": \"bytes32\"\n            },\n            {\n              \"internalType\": \"euint32\",\n              \"name\": \"encryptedMindsetPositive\",\n              \"type\": \"bytes32\"\n            },\n            {\n              \"internalType\": \"uint256\",\n              \"name\": \"timestamp\",\n              \"type\": \"uint256\"\n            },\n            {\n              \"internalType\": \"bool\",\n              \"name\": \"exists\",\n              \"type\": \"bool\"\n            }\n          ],\n          \"internalType\": \"struct EncryptedNightlyReflection.ReflectionEntry\",\n          \"name\": \"entry\",\n          \"type\": \"tuple\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEntryAchievementLevel\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"encryptedAchievementLevel\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEntryContent\",\n      \"outputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"content\",\n          \"type\": \"string\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEntryMindset\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"encryptedMindsetPositive\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getEntryStressLevel\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"encryptedStressLevel\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getTotalEntries\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"count\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getUserEntries\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256[]\",\n          \"name\": \"entryIds\",\n          \"type\": \"uint256[]\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getUserEntryByIndex\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"entryId\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getUserEntryCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"count\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,gCAAgC;IAC3C,OAAO;QACL;YACE,UAAU,EAAE;YACZ,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,cAAc;wBACZ;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;wBACA;4BACE,gBAAgB;4BAChB,QAAQ;4BACR,QAAQ;wBACV;qBACD;oBACD,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1053, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/hooks/useReflectionContract.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useMemo } from \"react\";\nimport { useAccount, useChainId, useWalletClient, usePublicClient } from \"wagmi\";\nimport { ethers } from \"ethers\";\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useInMemoryStorage } from \"./useInMemoryStorage\";\nimport { EncryptedNightlyReflectionAddresses } from \"@/abi/EncryptedNightlyReflectionAddresses\";\nimport { EncryptedNightlyReflectionABI } from \"@/abi/EncryptedNightlyReflectionABI\";\n\nexport const useReflectionContract = () => {\n  const { address, isConnected } = useAccount();\n  const chainId = useChainId();\n  const { data: walletClient } = useWalletClient();\n  const publicClient = usePublicClient();\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\n\n  const [fheLoading, setFheLoading] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Get contract address for current chain\n  const contractAddress = useMemo(() => {\n    if (!chainId) return undefined;\n    return EncryptedNightlyReflectionAddresses[chainId.toString()]?.address;\n  }, [chainId]);\n\n  // Use window.ethereum for FHEVM (it needs Eip1193Provider)\n  const fhevmProvider = useMemo(() => {\n    if (typeof window !== \"undefined\" && window.ethereum) {\n      return window.ethereum as ethers.Eip1193Provider;\n    }\n    // For hardhat/localhost, use the RPC URL\n    if (chainId === 31337) {\n      return \"http://localhost:8545\";\n    }\n    return undefined;\n  }, [chainId]);\n\n  // Create ethers provider from public client for contract calls\n  const provider = useMemo(() => {\n    if (!publicClient) return undefined;\n    // Convert viem publicClient to ethers JsonRpcProvider\n    const transport = (publicClient as any).transport;\n    if (transport && transport.url) {\n      return new ethers.JsonRpcProvider(transport.url);\n    }\n    // Fallback: use window.ethereum\n    if (typeof window !== \"undefined\" && window.ethereum) {\n      return new ethers.BrowserProvider(window.ethereum);\n    }\n    return undefined;\n  }, [publicClient]);\n\n  // Initialize FHEVM instance - only when wallet is connected and provider is available\n  const shouldEnableFhevm = isConnected && !!fhevmProvider && !!chainId;\n  const { instance: fhevmInstance, status: fhevmStatus, error: fhevmError } = useFhevm({\n    provider: fhevmProvider,\n    chainId,\n    enabled: shouldEnableFhevm,\n    initialMockChains: { 31337: \"http://localhost:8545\" },\n  });\n\n  const addReflection = useCallback(\n    async (\n      content: string,\n      stressLevel: number,\n      achievementLevel: number,\n      mindsetPositive: boolean\n    ) => {\n      if (!fhevmInstance || fhevmStatus !== \"ready\") {\n        throw new Error(\"FHEVM instance not ready. Status: \" + fhevmStatus);\n      }\n      if (!walletClient || !contractAddress || !address) {\n        throw new Error(\"Wallet, contract, or address not available\");\n      }\n\n      setFheLoading(true);\n      setIsLoading(true);\n\n      try {\n        // Helper function to encrypt with retry logic\n        const encryptWithRetry = async (\n          value: number,\n          fieldName: string,\n          maxRetries: number = 3\n        ) => {\n          let retryCount = 0;\n          let lastError: Error | null = null;\n\n          while (retryCount < maxRetries) {\n            try {\n              console.log(`[useReflectionContract] Encrypting ${fieldName} (attempt ${retryCount + 1}/${maxRetries})...`);\n              const input = fhevmInstance.createEncryptedInput(contractAddress, address);\n              input.add32(value);\n              const encrypted = await input.encrypt();\n              console.log(`[useReflectionContract] ${fieldName} encryption successful`);\n              return encrypted;\n            } catch (encryptError: any) {\n              retryCount++;\n              lastError = encryptError;\n              const errorMessage = encryptError?.message || String(encryptError);\n              console.warn(`[useReflectionContract] ${fieldName} encryption attempt ${retryCount} failed:`, errorMessage);\n\n              if (retryCount >= maxRetries) {\n                throw new Error(\n                  `Failed to encrypt ${fieldName} after ${maxRetries} attempts. ` +\n                  `Last error: ${errorMessage}. ` +\n                  `This may be due to FHEVM Relayer service issues. Please try again later.`\n                );\n              }\n\n              // Exponential backoff: 2s, 4s, 8s\n              const waitTime = Math.pow(2, retryCount) * 1000;\n              console.log(`[useReflectionContract] Waiting ${waitTime / 1000}s before retry...`);\n              await new Promise((resolve) => setTimeout(resolve, waitTime));\n            }\n          }\n\n          throw lastError || new Error(`Failed to encrypt ${fieldName}`);\n        };\n\n        // Content is stored as plaintext, only encrypt the numeric fields\n        // Encrypt stress level (ensure value is within uint32 range)\n        const stressValue = Math.max(0, Math.min(100, Math.floor(stressLevel)));\n        const encryptedStressLevel = await encryptWithRetry(stressValue, \"stress level\");\n\n        // Encrypt achievement level (ensure value is within uint32 range)\n        const achievementValue = Math.max(0, Math.min(100, Math.floor(achievementLevel)));\n        const encryptedAchievementLevel = await encryptWithRetry(achievementValue, \"achievement level\");\n\n        // Encrypt mindset (as uint32: 0=false, 1=true)\n        const mindsetValue = mindsetPositive ? 1 : 0;\n        const encryptedMindsetPositive = await encryptWithRetry(mindsetValue, \"mindset\");\n\n        setFheLoading(false);\n\n        // Create contract instance using walletClient\n        if (!walletClient) throw new Error(\"Wallet client not available\");\n        \n        // Use viem's walletClient to send transaction\n        const { createWalletClient, http } = await import(\"viem\");\n        const { privateKeyToAccount } = await import(\"viem/accounts\");\n        \n        // For now, use window.ethereum directly\n        if (typeof window === \"undefined\" || !window.ethereum) {\n          throw new Error(\"Ethereum provider not available\");\n        }\n        \n        const ethersProvider = new ethers.BrowserProvider(window.ethereum);\n        const signer = await ethersProvider.getSigner();\n\n        const contract = new ethers.Contract(\n          contractAddress,\n          EncryptedNightlyReflectionABI.abi,\n          signer\n        );\n\n        // Call addReflection - note: contract expects content as string, not encrypted\n        const tx = await contract.addReflection(\n          content, // Plaintext content (as per updated contract)\n          encryptedStressLevel.handles[0],\n          encryptedStressLevel.inputProof,\n          encryptedAchievementLevel.handles[0],\n          encryptedAchievementLevel.inputProof,\n          encryptedMindsetPositive.handles[0],\n          encryptedMindsetPositive.inputProof\n        );\n\n        const receipt = await tx.wait();\n        console.log(\"[useReflectionContract] Transaction confirmed:\", receipt?.hash);\n        // Wait a bit more for the state to be updated on-chain\n        await new Promise(resolve => setTimeout(resolve, 1000));\n      } finally {\n        setFheLoading(false);\n        setIsLoading(false);\n      }\n    },\n    [fhevmInstance, walletClient, contractAddress, address, provider]\n  );\n\n  const getUserEntries = useCallback(async (): Promise<bigint[]> => {\n    if (!provider || !contractAddress || !address) {\n      return [];\n    }\n\n    try {\n      const contract = new ethers.Contract(\n        contractAddress,\n        EncryptedNightlyReflectionABI.abi,\n        provider\n      );\n\n      const entryIds = await contract.getUserEntries(address);\n      return entryIds;\n    } catch (error: any) {\n      // Only log real errors, ignore network errors from external services\n      const errorMsg = error?.message?.toLowerCase() || String(error).toLowerCase();\n      if (!errorMsg.includes(\"failed to fetch\") && !errorMsg.includes(\"network\")) {\n        console.error(\"Error getting user entries:\", error);\n      }\n      return [];\n    }\n  }, [provider, contractAddress, address]);\n\n  const getEntry = useCallback(\n    async (entryId: number) => {\n      if (!provider || !contractAddress) {\n        throw new Error(\"Provider or contract not available\");\n      }\n\n      const contract = new ethers.Contract(\n        contractAddress,\n        EncryptedNightlyReflectionABI.abi,\n        provider\n      );\n\n      const entry = await contract.getEntry(entryId);\n      return entry;\n    },\n    [provider, contractAddress]\n  );\n\n  const decryptEntry = useCallback(\n    async (entryId: number) => {\n      if (!fhevmInstance || !walletClient || !contractAddress || !address) {\n        throw new Error(\"FHEVM instance, wallet, or contract not available\");\n      }\n\n      setIsLoading(true);\n\n      try {\n        // Get entry data\n        const entry = await getEntry(entryId);\n        \n        // Content is stored as plaintext string\n        const content = entry.content;\n        \n        // Decrypt encrypted fields\n        const encryptedStressLevelHandle = entry.encryptedStressLevel;\n        const encryptedAchievementLevelHandle = entry.encryptedAchievementLevel;\n        const encryptedMindsetHandle = entry.encryptedMindsetPositive;\n\n        // Use FHEVM to decrypt - always sign fresh (don't use cache to ensure wallet popup)\n        // Generate new keypair for this decryption\n        const { publicKey, privateKey } = fhevmInstance.generateKeypair();\n        \n        // Create EIP712 data\n        const startTimestamp = Math.floor(Date.now() / 1000);\n        const durationDays = 365;\n        const eip712 = fhevmInstance.createEIP712(\n          publicKey,\n          [contractAddress],\n          startTimestamp,\n          durationDays\n        );\n        \n        // Sign with wallet (this will trigger wallet popup)\n        console.log(\"[useReflectionContract] Requesting wallet signature for decryption...\");\n        let signature: string;\n        \n        // Use wagmi walletClient for signing (this will trigger Rainbow wallet popup)\n        if (!walletClient) {\n          throw new Error(\"Wallet client not available for signing\");\n        }\n        \n        try {\n          signature = await walletClient.signTypedData({\n            account: address as `0x${string}`,\n            domain: eip712.domain as any,\n            types: { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification } as any,\n            primaryType: 'UserDecryptRequestVerification',\n            message: eip712.message as any,\n          });\n          console.log(\"[useReflectionContract] Signature received from walletClient\");\n        } catch (error) {\n          console.error(\"[useReflectionContract] walletClient.signTypedData failed:\", error);\n          // Fallback to ethers signer if walletClient fails\n          const ethersProvider = new ethers.BrowserProvider(window.ethereum!);\n          const signer = await ethersProvider.getSigner();\n          signature = await signer.signTypedData(\n            eip712.domain,\n            { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n            eip712.message\n          );\n        }\n        \n        console.log(\"[useReflectionContract] Signature obtained, proceeding with decryption...\");\n\n        // Decrypt stress level\n        const stressLevelResult = await fhevmInstance.userDecrypt(\n          [{ handle: encryptedStressLevelHandle, contractAddress }],\n          privateKey,\n          publicKey,\n          signature,\n          [contractAddress],\n          address as `0x${string}`,\n          startTimestamp,\n          durationDays\n        );\n\n        // Decrypt achievement level\n        const achievementLevelResult = await fhevmInstance.userDecrypt(\n          [{ handle: encryptedAchievementLevelHandle, contractAddress }],\n          privateKey,\n          publicKey,\n          signature,\n          [contractAddress],\n          address as `0x${string}`,\n          startTimestamp,\n          durationDays\n        );\n\n        // Decrypt mindset\n        const mindsetResult = await fhevmInstance.userDecrypt(\n          [{ handle: encryptedMindsetHandle, contractAddress }],\n          privateKey,\n          publicKey,\n          signature,\n          [contractAddress],\n          address as `0x${string}`,\n          startTimestamp,\n          durationDays\n        );\n\n        return {\n          content: content,\n          stressLevel: Number(stressLevelResult[encryptedStressLevelHandle]),\n          achievementLevel: Number(achievementLevelResult[encryptedAchievementLevelHandle]),\n          mindsetPositive: Boolean(mindsetResult[encryptedMindsetHandle]),\n          timestamp: Number(entry.timestamp),\n        };\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [fhevmInstance, walletClient, contractAddress, address, getEntry]\n  );\n\n  return {\n    addReflection,\n    getUserEntries,\n    getEntry,\n    decryptEntry,\n    fheLoading,\n    isLoading,\n    contractAddress,\n    isDeployed: !!contractAddress && contractAddress !== ethers.ZeroAddress,\n    fhevmStatus,\n    fhevmError,\n    fhevmReady: fhevmStatus === \"ready\" && !!fhevmInstance,\n  };\n};\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1390, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/components/ReflectionForm.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState } from \"react\";\r\nimport { useAccount } from \"wagmi\";\r\nimport { useReflectionContract } from \"../hooks/useReflectionContract\";\r\nimport \"../styles/ReflectionForm.css\";\r\n\r\ninterface ReflectionFormProps {\r\n  onEntryAdded?: () => void;\r\n}\r\n\r\nexport const ReflectionForm: React.FC<ReflectionFormProps> = ({ onEntryAdded }) => {\r\n  const [content, setContent] = useState(\"\");\r\n  const [stressLevel, setStressLevel] = useState(50);\r\n  const [achievementLevel, setAchievementLevel] = useState(50);\r\n  const [mindsetPositive, setMindsetPositive] = useState(true);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n  const { address } = useAccount();\r\n  const { addReflection, fheLoading, fhevmReady, fhevmStatus, fhevmError } = useReflectionContract();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSuccessMessage(null);\r\n    setErrorMessage(null);\r\n\r\n    if (!content.trim()) {\r\n      setErrorMessage(\"Please enter your reflection content\");\r\n      return;\r\n    }\r\n\r\n    if (!address) {\r\n      setErrorMessage(\"Please connect your wallet\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      await addReflection(\r\n        content.trim(),\r\n        stressLevel,\r\n        achievementLevel,\r\n        mindsetPositive\r\n      );\r\n      setContent(\"\");\r\n      setStressLevel(50);\r\n      setAchievementLevel(50);\r\n      setMindsetPositive(true);\r\n      setSuccessMessage(\"Reflection entry added successfully!\");\r\n      // Auto-hide success message after 3 seconds\r\n      setTimeout(() => setSuccessMessage(null), 3000);\r\n      // Trigger list refresh after transaction is confirmed\r\n      if (onEntryAdded) {\r\n        // Wait for transaction to be mined and indexed\r\n        // Hardhat local network is fast, but we still need to wait a bit\r\n        setTimeout(() => {\r\n          console.log(\"[ReflectionForm] Triggering list refresh after entry added\");\r\n          onEntryAdded();\r\n        }, 3000);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error adding reflection entry:\", error);\r\n      // Only show error if it's a real contract/transaction error\r\n      // Ignore network errors from external services (WalletConnect, analytics, etc.)\r\n      const errorMessage = error?.message || String(error);\r\n      const errorString = errorMessage.toLowerCase();\r\n      \r\n      // Filter out non-critical errors that don't affect functionality\r\n      const ignoredErrors = [\r\n        \"failed to fetch\",\r\n        \"analytics\",\r\n        \"walletconnect\",\r\n        \"web3modal\",\r\n        \"coinbase\",\r\n        \"cca-lite\",\r\n        \"pulse.walletconnect\",\r\n        \"api.web3modal\",\r\n        \"network error\",\r\n        \"cors\",\r\n        \"blocked by response\",\r\n      ];\r\n      \r\n      const shouldIgnore = ignoredErrors.some(ignored => \r\n        errorString.includes(ignored)\r\n      );\r\n      \r\n      if (shouldIgnore) {\r\n        // These are external service errors, don't show to user\r\n        // Just log to console for debugging\r\n        console.log(\"Ignored non-critical error:\", errorMessage);\r\n        return;\r\n      }\r\n      \r\n      // Check for FHEVM Relayer errors and provide helpful message\r\n      if (\r\n        errorString.includes(\"relayer\") ||\r\n        errorString.includes(\"bad json\") ||\r\n        errorString.includes(\"connection closed\") ||\r\n        errorString.includes(\"encrypt\") ||\r\n        errorString.includes(\"failed to encrypt\")\r\n      ) {\r\n        setErrorMessage(\r\n          \"FHEVM Relayer service is temporarily unavailable. \" +\r\n          \"This is a network issue with the encryption service. Please try again in a few moments.\"\r\n        );\r\n      } else {\r\n        // Only show real business logic errors\r\n        setErrorMessage(\"Failed to add reflection entry. Please try again.\");\r\n      }\r\n      // Auto-hide error message after 5 seconds\r\n      setTimeout(() => setErrorMessage(null), 5000);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const isButtonDisabled = isLoading || !content.trim() || fheLoading || !fhevmReady;\r\n\r\n  return (\r\n    <div className=\"reflection-form\">\r\n      <h2 className=\"reflection-form-title\">\r\n        Add New Reflection Entry\r\n      </h2>\r\n\r\n      <form onSubmit={handleSubmit} className=\"reflection-form-form\">\r\n        {successMessage && (\r\n          <div className=\"mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded text-green-200 text-sm\">\r\n             {successMessage}\r\n          </div>\r\n        )}\r\n        {errorMessage && (\r\n          <div className=\"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded text-red-200 text-sm\">\r\n             {errorMessage}\r\n          </div>\r\n        )}\r\n        <div className=\"reflection-form-group\">\r\n          <label htmlFor=\"content\" className=\"reflection-form-label\">\r\n            Reflection Content\r\n          </label>\r\n          <textarea\r\n            id=\"content\"\r\n            rows={6}\r\n            className=\"reflection-form-textarea\"\r\n            placeholder=\"Write your nightly reflection here... What were your thoughts today?\"\r\n            value={content}\r\n            onChange={(e) => setContent(e.target.value)}\r\n            disabled={isLoading}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"reflection-form-group\">\r\n          <label htmlFor=\"stressLevel\" className=\"reflection-form-label\">\r\n            Stress Level: {stressLevel}%\r\n          </label>\r\n          <input\r\n            type=\"range\"\r\n            id=\"stressLevel\"\r\n            min=\"0\"\r\n            max=\"100\"\r\n            value={stressLevel}\r\n            onChange={(e) => setStressLevel(Number(e.target.value))}\r\n            className=\"reflection-form-range\"\r\n            disabled={isLoading}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"reflection-form-group\">\r\n          <label htmlFor=\"achievementLevel\" className=\"reflection-form-label\">\r\n            Achievement Level: {achievementLevel}%\r\n          </label>\r\n          <input\r\n            type=\"range\"\r\n            id=\"achievementLevel\"\r\n            min=\"0\"\r\n            max=\"100\"\r\n            value={achievementLevel}\r\n            onChange={(e) => setAchievementLevel(Number(e.target.value))}\r\n            className=\"reflection-form-range\"\r\n            disabled={isLoading}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"reflection-form-group\">\r\n          <label className=\"reflection-form-label\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={mindsetPositive}\r\n              onChange={(e) => setMindsetPositive(e.target.checked)}\r\n              className=\"reflection-form-checkbox\"\r\n              disabled={isLoading}\r\n            />\r\n            <span className=\"ml-2\">Positive mindset adjustment for tomorrow</span>\r\n          </label>\r\n        </div>\r\n\r\n        <div className=\"reflection-form-submit\">\r\n          {!fhevmReady && fhevmStatus !== \"ready\" && (\r\n            <div className=\"mb-4 p-3 bg-yellow-500/20 border border-yellow-500/50 rounded text-yellow-200 text-sm\">\r\n              {fhevmStatus === \"loading\" && \"Initializing FHE encryption...\"}\r\n              {fhevmStatus === \"error\" && (() => {\r\n                const errorMsg = fhevmError?.message?.toLowerCase() || \"\";\r\n                // Only show FHE errors if they're not network-related\r\n                if (errorMsg.includes(\"failed to fetch\") || \r\n                    errorMsg.includes(\"network\") || \r\n                    errorMsg.includes(\"analytics\") ||\r\n                    errorMsg.includes(\"walletconnect\")) {\r\n                  return \"Initializing FHE encryption...\";\r\n                }\r\n                return `FHE initialization failed: ${fhevmError?.message || \"Unknown error\"}`;\r\n              })()}\r\n              {fhevmStatus === \"idle\" && \"Waiting for wallet connection...\"}\r\n            </div>\r\n          )}\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isButtonDisabled}\r\n            className={`reflection-form-button ${\r\n              isButtonDisabled\r\n                ? \"reflection-form-button-disabled\"\r\n                : \"reflection-form-button-active\"\r\n            }`}\r\n          >\r\n            {!fhevmReady\r\n              ? \"Initializing FHE...\"\r\n              : fheLoading\r\n                ? \"Encrypting...\"\r\n                : isLoading\r\n                  ? \"Adding Entry...\"\r\n                  : \"Add Reflection Entry\"}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1732, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/components/ReflectionList.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useAccount } from \"wagmi\";\r\nimport { useReflectionContract } from \"../hooks/useReflectionContract\";\r\nimport \"../styles/ReflectionList.css\";\r\n\r\ninterface ReflectionEntry {\r\n  id: number;\r\n  content: string;\r\n  stressLevel: number;\r\n  achievementLevel: number;\r\n  mindsetPositive: boolean;\r\n  timestamp: number;\r\n  encrypted: boolean;\r\n}\r\n\r\ninterface ReflectionListProps {\r\n  refreshTrigger?: number;\r\n}\r\n\r\nexport const ReflectionList: React.FC<ReflectionListProps> = ({ refreshTrigger = 0 }) => {\r\n  const { address } = useAccount();\r\n  const { getUserEntries, getEntry, decryptEntry, isLoading } = useReflectionContract();\r\n  const [entries, setEntries] = useState<ReflectionEntry[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [decryptingId, setDecryptingId] = useState<number | null>(null);\r\n\r\n  const loadEntries = React.useCallback(async () => {\r\n    if (!address) {\r\n      setEntries([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      console.log(\"[ReflectionList] Loading entries for address:\", address);\r\n      const entryIds = await getUserEntries();\r\n      console.log(\"[ReflectionList] Loaded entry IDs:\", entryIds, \"Type:\", typeof entryIds, \"Length:\", entryIds?.length);\r\n      \r\n      if (!entryIds || entryIds.length === 0) {\r\n        console.log(\"[ReflectionList] No entries found\");\r\n        setEntries([]);\r\n        return;\r\n      }\r\n      \r\n      const entriesData: ReflectionEntry[] = [];\r\n\r\n      for (const id of entryIds) {\r\n        const entryId = typeof id === 'bigint' ? Number(id) : Number(id);\r\n        entriesData.push({\r\n          id: entryId,\r\n          content: \"\",\r\n          stressLevel: 0,\r\n          achievementLevel: 0,\r\n          mindsetPositive: false,\r\n          timestamp: 0,\r\n          encrypted: true,\r\n        });\r\n      }\r\n\r\n      console.log(\"[ReflectionList] Setting entries:\", entriesData);\r\n      setEntries(entriesData);\r\n    } catch (error: any) {\r\n      // Only log real errors, ignore network errors from external services\r\n      const errorMsg = error?.message?.toLowerCase() || String(error).toLowerCase();\r\n      if (!errorMsg.includes(\"failed to fetch\") && !errorMsg.includes(\"network\")) {\r\n        console.error(\"[ReflectionList] Error loading entries:\", error);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [address, getUserEntries]);\r\n\r\n  const handleDecrypt = async (entryId: number) => {\r\n    setDecryptingId(entryId);\r\n    try {\r\n      const decrypted = await decryptEntry(entryId);\r\n      setEntries((prev) =>\r\n        prev.map((entry) =>\r\n          entry.id === entryId\r\n            ? {\r\n                ...entry,\r\n                ...decrypted,\r\n                encrypted: false,\r\n              }\r\n            : entry\r\n        )\r\n      );\r\n    } catch (error: any) {\r\n      // Only log real errors, ignore network errors from external services\r\n      const errorMsg = error?.message?.toLowerCase() || String(error).toLowerCase();\r\n      if (!errorMsg.includes(\"failed to fetch\") && !errorMsg.includes(\"network\")) {\r\n        console.error(\"Error decrypting entry:\", error);\r\n      }\r\n      // Don't show error to user if it's just a network issue\r\n    } finally {\r\n      setDecryptingId(null);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(\"[ReflectionList] useEffect triggered, address:\", address, \"refreshTrigger:\", refreshTrigger);\r\n    loadEntries();\r\n  }, [address, refreshTrigger, loadEntries]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"reflection-list\">\r\n        <h2 className=\"reflection-list-title\">My Reflections</h2>\r\n        <p className=\"text-center py-8\">Loading entries...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (entries.length === 0) {\r\n    return (\r\n      <div className=\"reflection-list\">\r\n        <h2 className=\"reflection-list-title\">My Reflections</h2>\r\n        <p className=\"text-center py-8 text-gray-600\">\r\n          No reflection entries yet. Create your first entry above!\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"reflection-list\">\r\n      <h2 className=\"reflection-list-title\">My Reflections</h2>\r\n      <div className=\"reflection-entries\">\r\n        {entries.map((entry) => (\r\n          <div key={entry.id} className=\"reflection-entry\">\r\n            <div className=\"reflection-entry-header\">\r\n              <span className=\"reflection-entry-id\">Entry #{entry.id}</span>\r\n              {entry.timestamp > 0 && (\r\n                <span className=\"reflection-entry-date\">\r\n                  {new Date(entry.timestamp * 1000).toLocaleDateString()}\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            {entry.encrypted ? (\r\n              <div className=\"reflection-entry-encrypted\">\r\n                <p className=\"text-gray-500 mb-4\">\r\n                  This entry is encrypted. Click decrypt to view your reflection.\r\n                </p>\r\n                <button\r\n                  onClick={() => handleDecrypt(entry.id)}\r\n                  disabled={decryptingId === entry.id || isLoading}\r\n                  className=\"reflection-decrypt-button\"\r\n                >\r\n                  {decryptingId === entry.id ? \"Decrypting...\" : \"Decrypt Entry\"}\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"reflection-entry-content\">\r\n                <div className=\"reflection-entry-text\">\r\n                  <strong>Reflection:</strong>\r\n                  <p>{entry.content}</p>\r\n                </div>\r\n                <div className=\"reflection-entry-metrics\">\r\n                  <div className=\"reflection-metric\">\r\n                    <span className=\"reflection-metric-label\">Stress Level:</span>\r\n                    <span className=\"reflection-metric-value\">{entry.stressLevel}%</span>\r\n                  </div>\r\n                  <div className=\"reflection-metric\">\r\n                    <span className=\"reflection-metric-label\">Achievement Level:</span>\r\n                    <span className=\"reflection-metric-value\">{entry.achievementLevel}%</span>\r\n                  </div>\r\n                  <div className=\"reflection-metric\">\r\n                    <span className=\"reflection-metric-label\">Mindset:</span>\r\n                    <span className={`reflection-metric-value ${entry.mindsetPositive ? \"text-green-600\" : \"text-red-600\"}`}>\r\n                      {entry.mindsetPositive ? \"Positive\" : \"Needs Adjustment\"}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2112, "column": 0}, "map": {"version":3,"sources":["file:///C:/KS-Ku/demo30/pro30/frontend/components/ReflectionApp.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState, useCallback } from \"react\";\r\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\r\nimport { useAccount } from \"wagmi\";\r\nimport { ReflectionForm } from \"./ReflectionForm\";\r\nimport { ReflectionList } from \"./ReflectionList\";\r\nimport { useReflectionContract } from \"../hooks/useReflectionContract\";\r\nimport \"../styles/App.css\";\r\n\r\nexport const ReflectionApp: React.FC = () => {\r\n  const [mounted, setMounted] = useState(false);\r\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n  const { isConnected } = useAccount();\r\n  const { fheLoading, contractAddress, isDeployed } = useReflectionContract();\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  // Callback to trigger list refresh after successful submission\r\n  const handleEntryAdded = useCallback(() => {\r\n    setRefreshTrigger(prev => prev + 1);\r\n  }, []);\r\n\r\n  if (!mounted) {\r\n    return (\r\n      <div className=\"app-container\">\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"text-white\">Loading...</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <div className=\"main-content\">\r\n        <div className=\"content-wrapper\">\r\n          <div className=\"title-section\">\r\n            <h1 className=\"main-title text-white\">\r\n              Encrypted Nightly Reflection\r\n            </h1>\r\n            <p className=\"main-subtitle text-gray-200\">\r\n              Record your daily reflections with complete privacy. Your thoughts about stress, achievements, and mindset adjustments are encrypted using Zama FHE technology.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end mb-4\">\r\n            <ConnectButton />\r\n          </div>\r\n\r\n          {!isConnected ? (\r\n            <div className=\"connect-card\">\r\n              <h2 className=\"connect-title\">\r\n                Connect Your Wallet\r\n              </h2>\r\n              <p className=\"connect-subtitle\">\r\n                Connect your Rainbow wallet to start creating your encrypted reflection entries\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"content-sections\">\r\n              <ReflectionForm onEntryAdded={handleEntryAdded} />\r\n              <ReflectionList refreshTrigger={refreshTrigger} />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;;AAUO,MAAM,gBAA0B;;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,qLAAQ,EAAC;IACvC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,qLAAQ,EAAC;IACrD,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,wLAAU;IAClC,MAAM,EAAE,UAAU,EAAE,eAAe,EAAE,UAAU,EAAE,GAAG,IAAA,uKAAqB;IAEzE,IAAA,sLAAS;mCAAC;YACR,WAAW;QACb;kCAAG,EAAE;IAEL,+DAA+D;IAC/D,MAAM,mBAAmB,IAAA,wLAAW;uDAAC;YACnC;+DAAkB,CAAA,OAAQ,OAAO;;QACnC;sDAAG,EAAE;IAEL,IAAI,CAAC,SAAS;QACZ,qBACE,yMAAC;YAAI,WAAU;sBACb,cAAA,yMAAC;gBAAI,WAAU;0BACb,cAAA,yMAAC;oBAAI,WAAU;8BAAa;;;;;;;;;;;;;;;;IAIpC;IAEA,qBACE,yMAAC;QAAI,WAAU;kBACb,cAAA,yMAAC;YAAI,WAAU;sBACb,cAAA,yMAAC;gBAAI,WAAU;;kCACb,yMAAC;wBAAI,WAAU;;0CACb,yMAAC;gCAAG,WAAU;0CAAwB;;;;;;0CAGtC,yMAAC;gCAAE,WAAU;0CAA8B;;;;;;;;;;;;kCAK7C,yMAAC;wBAAI,WAAU;kCACb,cAAA,yMAAC,8MAAa;;;;;;;;;;oBAGf,CAAC,4BACA,yMAAC;wBAAI,WAAU;;0CACb,yMAAC;gCAAG,WAAU;0CAAgB;;;;;;0CAG9B,yMAAC;gCAAE,WAAU;0CAAmB;;;;;;;;;;;iFAKlC,yMAAC;wBAAI,WAAU;;0CACb,yMAAC,8JAAc;gCAAC,cAAc;;;;;;0CAC9B,yMAAC,8JAAc;gCAAC,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO9C;GA7Da;;QAGa,wLAAU;QACkB,uKAAqB;;;KAJ9D","debugId":null}}]
}